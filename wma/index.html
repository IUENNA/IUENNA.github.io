// Zeichensteuerung hinzufÃ¼gen
const drawnItems = new L.FeatureGroup();
map.addLayer(drawnItems);

const drawControl = new L.Control.Draw({
    draw: {
        polyline: false,
        polygon: false,
        circle: false,
        marker: false,
        circlemarker: false,
        rectangle: true
    },
    edit: {
        featureGroup: drawnItems
    }
});
map.addControl(drawControl);

// Listener fÃ¼r das Zeichnen von Rechtecken
map.on(L.Draw.Event.CREATED, function(event) {
    const layer = event.layer;
    if (event.layerType === 'rectangle') {
        const bounds = layer.getBounds();

        // Marker auswÃ¤hlen, die im Rechteck liegen
        const selectedMarkers = [];
        filteredData.forEach(data => {
            if (data.coordinates && bounds.contains([data.coordinates[1], data.coordinates[0]])) {
                selectedMarkers.push(data);
            }
        });

        // Markierte Marker hervorheben
        markerCluster.clearLayers();
        selectedMarkers.forEach(data => {
            if (data.coordinates) {
                const marker = L.marker([data.coordinates[1], data.coordinates[0]], {
                    icon: L.icon({
                        iconUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-red.png',
                        iconSize: [25, 41],
                        iconAnchor: [12, 41]
                    })
                });
                marker.bindPopup(`<b>${data.title}</b><br>${data.location}<br>ðŸ”—<a href="${data.pid}" target="_blank">ARCHE Permalink</a>`);
                markerCluster.addLayer(marker);
            }
        });

        // Optional: Markierte Daten in der Konsole anzeigen
        console.log('AusgewÃ¤hlte Punkte:', selectedMarkers);

        updateCounter(selectedMarkers.length);
    }

    drawnItems.addLayer(layer);
});
